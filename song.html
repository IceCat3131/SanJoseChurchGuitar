<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>è¯—æ­Œå‰ä»–è°±æŸ¥çœ‹</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="page">
    <header class="header header-song">
      <a href="index.html" class="back-arrow">â†</a>
      <div class="title-with-arrows">
        <button id="btn-prev" class="nav-arrow">&lt;</button>
        <h1 id="song-title">è¯—æ­Œå‰ä»–è°±</h1>
        <button id="btn-next" class="nav-arrow">&gt;</button>
      </div>
    </header>


    <section class="controls">
          <div class="book-switch">
            <button id="btn-book-c" class="book-button active" data-book="c">å¤§æœ¬</button>
            <button id="btn-book-ts" class="book-button" data-book="ts">å°æœ¬</button>
          </div>
          <div class="search-area">
            <input id="search-no" type="number" min="1" placeholder="è¾“å…¥ç¼–å·ï¼Œå¦‚ 7 æˆ– 788">
            <!-- æ”¾å¤§é•œæŒ‰é’® -->
            <button id="search-btn" class="search-button" title="è·³è½¬åˆ°è¯¥ç¼–å·">
              ğŸ”
            </button>
          </div>
        </section>


    <main>
      <div id="score-container" class="score-container">
        <!-- SVG å°†æ’å…¥åˆ°è¿™é‡Œ -->
      </div>
    </main>

    <footer class="footer">
      <p id="file-info" class="file-info"></p>
    </footer>
  </div>


  <script>
    const HYMNBOOKS = {
      c: { id: "c", label: "å¤§æœ¬è¯—æ­Œ", prefix: "c", count: 1000, folder: "c" },
      ts: { id: "ts", label: "å°æœ¬è¯—æ­Œ", prefix: "ts", count: 1000, folder: "ts" }
    };

    function getParams() {
      const params = new URLSearchParams(location.search);
      let book = params.get("book") || "c";
      let no = parseInt(params.get("no") || "1", 10);
      if (!(book in HYMNBOOKS)) book = "c";
      const cfg = HYMNBOOKS[book];
      if (isNaN(no) || no < 1) no = 1;
      if (no > cfg.count) no = cfg.count;
      return { book, no };
    }

    function pad4(n) {
      return String(n).padStart(4, "0");
    }

    // å½“å‰é€‰ä¸­çš„å†Œï¼ˆç»™æœç´¢ç”¨ï¼‰
    let currentBook = "c";

    function applyBookUI(book) {
      const btnBookC = document.getElementById("btn-book-c");
      const btnBookTs = document.getElementById("btn-book-ts");
      if (btnBookC && btnBookTs) {
        btnBookC.classList.toggle("active", book === "c");
        btnBookTs.classList.toggle("active", book === "ts");
      }
      currentBook = book;
    }

    function updatePage() {
      const { book, no } = getParams();
      const cfg = HYMNBOOKS[book];

      // åŒæ­¥é¡¶éƒ¨æŒ‰é’®å’Œæœç´¢æ¡†çš„å€¼
      applyBookUI(book);
      const searchInput = document.getElementById("search-no");
      if (searchInput) searchInput.value = no;

      const titleEl = document.getElementById("song-title");
      const subEl = document.getElementById("song-subtitle");
      const infoEl = document.getElementById("file-info");
      const container = document.getElementById("score-container");

      const noStr = pad4(no);
      const filename = `${cfg.prefix}${noStr}_cn_g.svg`;
      const path = `assets/${cfg.folder}/${filename}`;

      titleEl.textContent = `${cfg.label} ç¬¬ ${no} é¦–`;
      if (subEl) subEl.textContent = "";
      if (infoEl) infoEl.textContent = "";

      container.innerHTML = "";
      const img = document.createElement("img");
      img.src = path;
      img.alt = titleEl.textContent;
      img.className = "score-svg";
      container.appendChild(img);

      document.title = `${titleEl.textContent} - å¬ä¼šè¯—æ­Œå‰ä»–è°±`;
    }

    function gotoSong(book, no) {
      const cfg = HYMNBOOKS[book];
      if (no < 1) no = 1;
      if (no > cfg.count) no = cfg.count;
      location.search = `?book=${book}&no=${no}`;
    }

    // ä¸Šä¸€é¦– / ä¸‹ä¸€é¦–
    document.getElementById("btn-prev").addEventListener("click", () => {
      const { book, no } = getParams();
      gotoSong(book, no - 1);
    });

    document.getElementById("btn-next").addEventListener("click", () => {
      const { book, no } = getParams();
      gotoSong(book, no + 1);
    });

    // æœç´¢æ é€»è¾‘ï¼ˆå’Œé¦–é¡µä¿æŒä¸€è‡´çš„è¡Œä¸ºï¼‰
    (function setupSearch() {
      const btnBookC = document.getElementById("btn-book-c");
      const btnBookTs = document.getElementById("btn-book-ts");
      const searchInput = document.getElementById("search-no");
      const searchBtn = document.getElementById("search-btn");

      if (!searchInput || !searchBtn || !btnBookC || !btnBookTs) return;

      btnBookC.addEventListener("click", () => {
        applyBookUI("c");
      });

      btnBookTs.addEventListener("click", () => {
        applyBookUI("ts");
      });

      function jumpToSong() {
        const val = searchInput.value.trim();
        if (!val) {
          alert("è¯·è¾“å…¥ç¼–å·ï¼Œä¾‹å¦‚ 7 æˆ– 788");
          return;
        }
        const no = parseInt(val, 10);
        const cfg = HYMNBOOKS[currentBook];
        if (isNaN(no) || no < 1 || no > cfg.count) {
          alert(`è¯·è¾“å…¥ 1 - ${cfg.count} ä¹‹é—´çš„ç¼–å·`);
          return;
        }
        gotoSong(currentBook, no);
      }

      searchBtn.addEventListener("click", jumpToSong);

      searchInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          jumpToSong();
        }
      });
    })();

    // åˆæ¬¡åŠ è½½å½“å‰é¡µ
    updatePage();
  </script>
</body>
</html>